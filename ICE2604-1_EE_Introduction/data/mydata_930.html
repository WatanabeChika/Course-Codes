<!DOCTYPE html>
<html>
<head>
<title>slope_selection</title>
</head>
<body>
<div class="mw-parser-output"><img alt="This is a good article. Click here for more information." data-file-height="185" data-file-width="180" decoding="async" height="20" src="//upload.wikimedia.org/wikipedia/en/thumb/9/94/Symbol_support_vote.svg/19px-Symbol_support_vote.svg.png" srcset="//upload.wikimedia.org/wikipedia/en/thumb/9/94/Symbol_support_vote.svg/29px-Symbol_support_vote.svg.png 1.5x, //upload.wikimedia.org/wikipedia/en/thumb/9/94/Symbol_support_vote.svg/39px-Symbol_support_vote.svg.png 2x" width="19"/></div><div class="mw-parser-output">
<p class="mw-empty-elt">
</p>
<style data-mw-deduplicate="TemplateStyles:r1033289096">.mw-parser-output .hatnote{font-style:italic}.mw-parser-output div.hatnote{padding-left:1.6em;margin-bottom:0.5em}.mw-parser-output .hatnote i{font-style:normal}.mw-parser-output .hatnote+link+.hatnote{margin-top:-0.5em}</style>

<p>In non-parametric statistics, the <b>Theil–Sen estimator</b> is a method for robustly fitting a line to sample points in the plane (simple linear regression) by choosing the median of the slopes of all lines through pairs of points. It has also been called <b>Sen's slope estimator</b>,<sup class="reference" id="cite_ref-1">[1]</sup><sup class="reference" id="cite_ref-ep01_2-0">[2]</sup> <b>slope selection</b>,<sup class="reference" id="cite_ref-detalg_3-0">[3]</sup><sup class="reference" id="cite_ref-randalg_4-0">[4]</sup> the <b>single median method</b>,<sup class="reference" id="cite_ref-5">[5]</sup> the <b>Kendall robust line-fit method</b>,<sup class="reference" id="cite_ref-6">[6]</sup> and the <b>Kendall–Theil robust line</b>.<sup class="reference" id="cite_ref-7">[7]</sup> It is named after Henri Theil and Pranab K. Sen, who published papers on this method in 1950 and 1968 respectively,<sup class="reference" id="cite_ref-theilsen_8-0">[8]</sup> and after Maurice Kendall because of its relation to the Kendall tau rank correlation coefficient.<sup class="reference" id="cite_ref-whyken_9-0">[9]</sup>
</p><p>This estimator can be computed efficiently, and is insensitive to outliers. It can be significantly more accurate than non-robust simple linear regression (least squares) for skewed and heteroskedastic data, and competes well against least squares even for normally distributed data in terms of statistical power.<sup class="reference" id="cite_ref-w01_10-0">[10]</sup> It has been called "the most popular nonparametric technique for estimating a linear trend".<sup class="reference" id="cite_ref-ep01_2-1">[2]</sup>
</p>

<h2><span class="mw-headline" id="Definition">Definition</span><span class="mw-editsection"></span></h2>
<p>As defined by Theil (1950), the Theil–Sen estimator of a set of two-dimensional points <span class="texhtml">(<i>x<sub>i</sub></i>,<i>y<sub>i</sub></i>)</span> is the median <span class="texhtml mvar" style="font-style:italic;">m</span> of the slopes <span class="texhtml">(<i>y<sub>j</sub></i> − <i>y<sub>i</sub></i>)/(<i>x<sub>j</sub></i> − <i>x<sub>i</sub></i>)</span> determined by all pairs of sample points. Sen (1968) extended this definition to handle the case in which two data points have the same <span class="texhtml mvar" style="font-style:italic;">x</span> coordinate. In Sen's definition, one takes the median of the slopes defined only from pairs of points having distinct <span class="texhtml mvar" style="font-style:italic;">x</span> coordinates.<sup class="reference" id="cite_ref-theilsen_8-1">[8]</sup>
</p><p>Once the slope <span class="texhtml mvar" style="font-style:italic;">m</span> has been determined, one may determine a line from the sample points by setting the <span class="texhtml mvar" style="font-style:italic;">y</span>-intercept <span class="texhtml mvar" style="font-style:italic;">b</span> to be the median of the values <span class="texhtml"><i>y<sub>i</sub></i> − <i>mx<sub>i</sub></i></span>. The fit line is then the line <span class="texhtml"><i>y</i> = <i>mx</i> + <i>b</i></span> with coefficients <span class="texhtml mvar" style="font-style:italic;">m</span> and <span class="texhtml mvar" style="font-style:italic;">b</span> in slope–intercept form.<sup class="reference" id="cite_ref-rl03_11-0">[11]</sup> As Sen observed, this choice of slope makes the Kendall tau rank correlation coefficient become approximately zero, when it is used to compare the values <span class="texhtml"><i>x<sub>i</sub></i></span> with their associated residuals <span class="texhtml"><i>y<sub>i</sub></i> − <i>mx<sub>i</sub></i> − <i>b</i></span>. Intuitively, this suggests that how far the fit line passes above or below a data point is not correlated with whether that point is on the left or right side of the data set. The choice of <span class="texhtml mvar" style="font-style:italic;">b</span> does not affect the Kendall coefficient, but causes the median residual to become approximately zero; that is, the fit line passes above and below equal numbers of points.<sup class="reference" id="cite_ref-whyken_9-1">[9]</sup>
</p><p>A confidence interval for the slope estimate may be determined as the interval containing the middle 95% of the slopes of lines determined by pairs of points<sup class="reference" id="cite_ref-12">[12]</sup> and may be estimated quickly by sampling pairs of points and determining the 95% interval of the sampled slopes. According to simulations, approximately 600 sample pairs are sufficient to determine an accurate confidence interval.<sup class="reference" id="cite_ref-w01_10-1">[10]</sup>
</p>
<h2><span class="mw-headline" id="Variations">Variations</span><span class="mw-editsection"></span></h2>
<p>A variation of the Theil–Sen estimator, the repeated median regression of Siegel (1982), determines for each sample point <span class="texhtml">(<i>x<sub>i</sub></i>,<i>y<sub>i</sub></i>)</span>, the median <span class="texhtml mvar" style="font-style:italic;">m<sub>i</sub></span> of the slopes <span class="texhtml">(<i>y<sub>j</sub></i> − <i>y<sub>i</sub></i>)/(<i>x<sub>j</sub></i> − <i>x<sub>i</sub></i>)</span> of lines through that point, and then determines the overall estimator as the median of these medians. It can tolerate a greater number of outliers than the Theil–Sen estimator, but known algorithms for computing it efficiently are more complicated and less practical.<sup class="reference" id="cite_ref-13">[13]</sup>
</p><p>A different variant pairs up sample points by the rank of their <span class="texhtml mvar" style="font-style:italic;">x</span>-coordinates: the point with the smallest coordinate is paired with the first point above the median coordinate, the second-smallest point is paired with the next point above the median, and so on. It then computes the median of the slopes of the lines determined by these pairs of points, gaining speed by examining significantly fewer pairs than the Theil–Sen estimator.<sup class="reference" id="cite_ref-14">[14]</sup>
</p><p>Variations of the Theil–Sen estimator based on weighted medians have also been studied, based on the principle that pairs of samples whose <span class="texhtml mvar" style="font-style:italic;">x</span>-coordinates differ more greatly are more likely to have an accurate slope and therefore should receive a higher weight.<sup class="reference" id="cite_ref-15">[15]</sup>
</p><p>For seasonal data, it may be appropriate to smooth out seasonal variations in the data by considering only pairs of sample points that both belong to the same month or the same season of the year, and finding the median of the slopes of the lines determined by this more restrictive set of pairs.<sup class="reference" id="cite_ref-hss82_16-0">[16]</sup>
</p>
<h2><span class="mw-headline" id="Statistical_properties">Statistical properties</span><span class="mw-editsection"></span></h2>
<p>The Theil–Sen estimator is an unbiased estimator of the true slope in simple linear regression.<sup class="reference" id="cite_ref-17">[17]</sup> For many distributions  of the response error, this estimator has high asymptotic efficiency relative to least-squares estimation.<sup class="reference" id="cite_ref-18">[18]</sup> Estimators with low efficiency require more independent observations to attain the same sample variance of efficient unbiased estimators.
</p><p>The Theil–Sen estimator is more robust than the least-squares estimator because it is much less sensitive to outliers. It has a breakdown point of
</p>
<dl><dd><span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle 1-{\frac {1}{\sqrt {2}}}\approx 29.3\%,}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mn>1</mn>
<mo>−<!-- − --></mo>
<mrow class="MJX-TeXAtom-ORD">
<mfrac>
<mn>1</mn>
<msqrt>
<mn>2</mn>
</msqrt>
</mfrac>
</mrow>
<mo>≈<!-- ≈ --></mo>
<mn>29.3</mn>
<mi mathvariant="normal">%<!-- % --></mi>
<mo>,</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle 1-{\frac {1}{\sqrt {2}}}\approx 29.3\%,}</annotation>
</semantics>
</math></span><img alt="{\displaystyle 1-{\frac {1}{\sqrt {2}}}\approx 29.3\%,}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e02c142782967ea2ad0bfd6caf553fe9c117e3f5" style="vertical-align: -2.838ex; width:17.753ex; height:6.176ex;"/></span></dd></dl>
<p>meaning that it can tolerate arbitrary corruption of up to 29.3% of the input data-points without degradation of its accuracy.<sup class="reference" id="cite_ref-rl03_11-1">[11]</sup> However, the breakdown point decreases for higher-dimensional generalizations of the method.<sup class="reference" id="cite_ref-w05_19-0">[19]</sup> A higher breakdown point, 50%, holds for a different robust line-fitting algorithm, the repeated median estimator of Siegel.<sup class="reference" id="cite_ref-rl03_11-2">[11]</sup>
</p><p>The Theil–Sen estimator is equivariant under every linear transformation of its response variable, meaning that transforming the data first and then fitting a line, or fitting a line first and then transforming it in the same way, both produce the same result.<sup class="reference" id="cite_ref-20">[20]</sup> However, it is not equivariant under affine transformations of both the predictor and response variables.<sup class="reference" id="cite_ref-w05_19-1">[19]</sup>
</p>
<h2><span class="mw-headline" id="Algorithms_and_implementation">Algorithms and implementation</span><span class="mw-editsection"></span></h2>
<p>The median slope of a set of <span class="texhtml mvar" style="font-style:italic;">n</span> sample points may be computed exactly by computing all <span class="texhtml"><i>O</i>(<i>n</i><sup>2</sup>)</span> lines through pairs of points, and then applying a linear time median finding algorithm. Alternatively, it may be estimated by sampling pairs of points. This problem is equivalent, under projective duality, to the problem of finding the crossing point in an arrangement of lines that has the median <span class="texhtml mvar" style="font-style:italic;">x</span>-coordinate among all such crossing points.<sup class="reference" id="cite_ref-FOOTNOTEColeSaloweSteigerSzemerédi1989_21-0">[21]</sup>
</p><p>The problem of performing slope selection exactly but more efficiently than the brute force quadratic time algorithm has been extensively studied in computational geometry. Several different methods are known for computing the Theil–Sen estimator exactly in <span class="texhtml"><i>O</i>(<i>n</i> log <i>n</i>)</span> time, either deterministically<sup class="reference" id="cite_ref-detalg_3-1">[3]</sup> or using randomized algorithms.<sup class="reference" id="cite_ref-randalg_4-1">[4]</sup> Siegel's repeated median estimator can also be constructed in the same time bound.<sup class="reference" id="cite_ref-FOOTNOTEMatoušekMountNetanyahu1998_22-0">[22]</sup> In models of computation in which the input coordinates are integers and in which bitwise operations on integers take constant time, the Theil–Sen estimator can be constructed even more quickly, in randomized expected time <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle O(n{\sqrt {\log n}})}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>O</mi>
<mo stretchy="false">(</mo>
<mi>n</mi>
<mrow class="MJX-TeXAtom-ORD">
<msqrt>
<mi>log</mi>
<mo>⁡<!-- ⁡ --></mo>
<mi>n</mi>
</msqrt>
</mrow>
<mo stretchy="false">)</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle O(n{\sqrt {\log n}})}</annotation>
</semantics>
</math></span><img alt="O(n{\sqrt  {\log n}})" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/1419f0276ea2dcbaa5c452537effa4a35a434814" style="vertical-align: -1.171ex; width:12.055ex; height:3.509ex;"/></span>.<sup class="reference" id="cite_ref-FOOTNOTEChanPătraşcu2010_23-0">[23]</sup>
</p><p>An estimator for the slope with approximately median rank, having the same breakdown point as the Theil–Sen estimator, may be maintained in the data stream model (in which the sample points are processed one by one by an algorithm that does not have enough persistent storage to represent the entire data set) using an algorithm based on ε-nets.<sup class="reference" id="cite_ref-FOOTNOTEBagchiChaudharyEppsteinGoodrich2007_24-0">[24]</sup>
</p><p>In the R statistics package, both the Theil–Sen estimator and Siegel's repeated median estimator are available through the <code>mblm</code> library.<sup class="reference" id="cite_ref-25">[25]</sup>
A free standalone Visual Basic application for Theil–Sen estimation, <code>KTRLine</code>, has been made available by the US Geological Survey.<sup class="reference" id="cite_ref-26">[26]</sup>
The Theil–Sen estimator has also been implemented in Python as part of the SciPy and scikit-learn libraries.<sup class="reference" id="cite_ref-27">[27]</sup>
</p>
<h2><span class="mw-headline" id="Applications">Applications</span><span class="mw-editsection"></span></h2>
<p>Theil–Sen estimation has been applied to astronomy due to its ability to handle censored regression models.<sup class="reference" id="cite_ref-FOOTNOTEAkritasMurphyLaValley1995_28-0">[28]</sup> In biophysics, Fernandes &amp; Leblanc (2005) suggest its use for remote sensing applications such as the estimation of leaf area from reflectance data due to its "simplicity in computation, analytical estimates of confidence intervals, robustness to outliers, testable assumptions regarding residuals and ... limited a priori information regarding measurement errors".<sup class="reference" id="cite_ref-FOOTNOTEFernandesLeblanc2005_29-0">[29]</sup> For measuring seasonal environmental data such as water quality, a seasonally adjusted variant of the Theil–Sen estimator has been proposed as preferable to least squares estimation due to its high precision in the presence of skewed data.<sup class="reference" id="cite_ref-hss82_16-1">[16]</sup> In computer science, the Theil–Sen method has been used to estimate trends in software aging.<sup class="reference" id="cite_ref-FOOTNOTEVaidyanathanTrivedi2005_30-0">[30]</sup> In meteorology and climatology, it has been used to estimate the long-term trends of wind occurrence and speed.<sup class="reference" id="cite_ref-FOOTNOTERomanićĆurićJovičićLompar2014_31-0">[31]</sup>
</p>
<h2><span class="mw-headline" id="See_also">See also</span><span class="mw-editsection"></span></h2>
<ul><li>Regression dilution, for another problem affecting estimated trend slopes</li></ul>
<h2><span class="mw-headline" id="Notes">Notes</span><span class="mw-editsection"></span></h2>
<style data-mw-deduplicate="TemplateStyles:r1011085734">.mw-parser-output .reflist{font-size:90%;margin-bottom:0.5em;list-style-type:decimal}.mw-parser-output .reflist .references{font-size:100%;margin-bottom:0;list-style-type:inherit}.mw-parser-output .reflist-columns-2{column-width:30em}.mw-parser-output .reflist-columns-3{column-width:25em}.mw-parser-output .reflist-columns{margin-top:0.3em}.mw-parser-output .reflist-columns ol{margin-top:0}.mw-parser-output .reflist-columns li{page-break-inside:avoid;break-inside:avoid-column}.mw-parser-output .reflist-upper-alpha{list-style-type:upper-alpha}.mw-parser-output .reflist-upper-roman{list-style-type:upper-roman}.mw-parser-output .reflist-lower-alpha{list-style-type:lower-alpha}.mw-parser-output .reflist-lower-greek{list-style-type:lower-greek}.mw-parser-output .reflist-lower-roman{list-style-type:lower-roman}</style>
<h2><span class="mw-headline" id="References">References</span><span class="mw-editsection"></span></h2>
<style data-mw-deduplicate="TemplateStyles:r1054258005">.mw-parser-output .refbegin{font-size:90%;margin-bottom:0.5em}.mw-parser-output .refbegin-hanging-indents>ul{margin-left:0}.mw-parser-output .refbegin-hanging-indents>ul>li{margin-left:0;padding-left:3.2em;text-indent:-3.2em}.mw-parser-output .refbegin-hanging-indents ul,.mw-parser-output .refbegin-hanging-indents ul li{list-style:none}@media(max-width:720px){.mw-parser-output .refbegin-hanging-indents>ul>li{padding-left:1.6em;text-indent:-1.6em}}.mw-parser-output .refbegin-columns{margin-top:0.3em}.mw-parser-output .refbegin-columns ul{margin-top:0}.mw-parser-output .refbegin-columns li{page-break-inside:avoid;break-inside:avoid-column}</style>
<!-- 
NewPP limit report
Parsed by mw2393
Cached time: 20221224025538
Cache expiry: 1814400
Reduced expiry: false
Complications: [vary‐revision‐sha1, show‐toc]
CPU time usage: 0.517 seconds
Real time usage: 0.691 seconds
Preprocessor visited node count: 4361/1000000
Post‐expand include size: 90604/2097152 bytes
Template argument size: 2578/2097152 bytes
Highest expansion depth: 10/100
Expensive parser function count: 1/500
Unstrip recursion depth: 0/20
Unstrip post‐expand size: 83998/5000000 bytes
Lua time usage: 0.342/10.000 seconds
Lua memory usage: 7774864/52428800 bytes
Number of Wikibase entities loaded: 0/400
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  587.131      1 -total
 55.90%  328.210     38 Template:Citation
 14.60%   85.737     42 Template:Harvtxt
 10.31%   60.525      1 Template:Reflist
  8.96%   52.611      1 Template:Short_description
  6.31%   37.026     22 Template:Main_other
  4.57%   26.861      2 Template:Pagetype
  3.35%   19.663      1 Template:Good_article
  3.20%   18.786      1 Template:Broader
  3.12%   18.307      8 Template:Sfnp
-->
<!-- Saved in parser cache with key enwiki:pcache:idhash:32292709-0!canonical and timestamp 20221224025538 and revision id 1067801825.
 -->
</div></body>
</html>