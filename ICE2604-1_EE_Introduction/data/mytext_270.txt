derangementIn combinatorial mathematics, a derangement is a permutation of the elements of a set, such that no element appears in its original position. In other words, a derangement is a permutation that has no fixed points.The number of derangements of a set of size n is known as the subfactorial of n or the n-th derangement number or n-th de Montmort number.  Notations for subfactorials in common use include !n, Dn, dn, or n¡.[1][2]For n &gt; 0, the subfactorial !n equals the nearest integer to n!/e, where n! denotes the factorial of n and e is Euler's number.[3]The problem of counting derangements was first considered by Pierre Raymond de Montmort[4] in 1708; he solved it in 1713, as did Nicholas Bernoulli at about the same time.Suppose that a professor gave a test to 4 students – A, B, C, and D – and wants to let them grade each other's tests. Of course, no student should grade their own test. How many ways could the professor hand the tests back to the students for grading, such that no student received their own test back? Out of 24 possible permutations (4!) for handing back the tests,,DC,CB,CDB,DBC,DB,BA,,BCA,,,BDA,CAB,,CA,CDA,,,,DAB,DAC,DA,,.there are only 9 derangements (shown in blue italics above). In every other permutation of this 4-member set, at least one student gets their own test back (shown in bold red).Another version of the problem arises when we ask for the number of ways n letters, each addressed to a different person, can be placed in n pre-addressed envelopes so that no letter appears in the correctly addressed envelope.Counting derangements of a set amounts to the hat-check problem, in which one considers the number of ways in which n hats (call them h1 through hn) can be returned to n people (P1 through Pn) such that no hat makes it back to its owner.[5]Each person may receive any of the n − 1 hats that is not their own. Call the hat which the person P1 receives hi and consider hi’s owner: Pi receives either P1's hat, h1, or some other. Accordingly, the problem splits into two possible cases:Pi receives a hat other than h1. This case is equivalent to solving the problem with n − 1 people and n − 1 hats because for each of the n − 1 people besides P1 there is exactly one hat from among the remaining n − 1 hats that they may not receive (for any Pj besides Pi, the unreceivable hat is hj, while for Pi it is h1). Another way to see this is to rename h1 to hi, where the derangement is more explicit: for any j from 2 to n, Pj cannot receive hj.Pi receives h1. In this case the problem reduces to n − 2 people and n − 2 hats, because P1 received his hat and Pi received h1's hat, effectively putting both out of further consideration.For each of the n − 1 hats that P1 may receive, the number of ways that P2, …, Pn may all receive hats is the sum of the counts for the two cases.This gives us the solution to the hat-check problem: stated algebraically, the number !n of derangements of an n-element set is for ,where  and .[6]The number of derangements of small lengths is given in the table below.The number of derangements of an n-element set (sequence  in the OEIS) for small nn012345678910111213!n10129442651,85414,833133,4961,334,96114,684,570176,214,8412,290,792,932There are various other expressions for !n, equivalent to the formula given above.  These include for and for where  is the nearest integer function and  is the floor function.[3][6]Other related formulas include[7]andThe following recurrence also holds:[6]One may derive a non-recursive formula for the number of derangements of an n-set, as well. For  we define  to be the set of permutations of n objects that fix the -th object. Any intersection of a collection of i of these sets fixes a particular set of i objects and therefore contains  permutations. There are  such collections, so the inclusion–exclusion principle yieldsand since a derangement is a permutation that leaves none of the n objects fixed, this impliesFromandby substituting  one immediately obtains thatThis is the limit of the probability that a randomly selected permutation of a large number of objects is a derangement. The probability converges to this limit extremely quickly as n increases, which is why !n is the nearest integer to n!/e. The above semi-log graph shows that the derangement graph lags the permutation graph by an almost constant value.More information about this calculation and the above limit may be found in the article on thestatistics of random permutations.An asymptotic expansion for the number of derangements in terms of Bell numbers is as follows:where  is any fixed positive integer, and  denotes the -th Bell number. Moreover, the constant implied by the big O-term does not exceed .[8]The problème des rencontres asks how many permutations of a size-n set have exactly k fixed points.Derangements are an example of the wider field of constrained permutations. For example, the ménage problem asks if n opposite-sex couples are seated man-woman-man-woman-... around a table, how many ways can they be seated so that nobody is seated next to his or her partner?More formally, given sets A and S, and some sets U and V of surjections A → S, we often wish to know the number of pairs of functions (f, g) such that f is in U and g is in V, and for all a in A, f(a) ≠ g(a); in other words, where for each f and g, there exists a derangement φ of S such that f(a) = φ(g(a)).Another generalization is the following problem:How many anagrams with no fixed letters of a given word are there?For instance, for a word made of only two different letters, say n letters A and m letters B, the answer is, of course, 1 or 0 according to whether n = m or not, for the only way to form an anagram without fixed letters is to exchange all the A with B, which is possible if and only if n = m.  In the general case, for a word with n1 letters X1, n2 letters X2, ..., nr letters Xr, it turns out (after a proper use of the inclusion-exclusion formula) that the answer has the formfor a certain sequence of polynomials Pn, where Pn has degree n.  But the above answer for the case r = 2 gives an orthogonality relation, whence the Pn's are the Laguerre polynomials (up to a sign that is easily decided).[9]In particular, for the classical derangements, one has thatwhere  is the upper incomplete gamma function.It is NP-complete to determine whether a given permutation group (described by a given set of permutations that generate it) contains any derangements.[10]Baez, John (2003). "Let's get deranged!" .Bogart, Kenneth P.; Doyle, Peter G. (1985). "Non-sexist solution of the ménage problem".Hassani, Mehdi. "Derangements and Applications". Journal of Integer Sequences (JIS), Volume 6, Issue 1, Article 03.1.2, 2003.Weisstein, Eric W. "Derangement". MathWorld–A Wolfram Web Resource.