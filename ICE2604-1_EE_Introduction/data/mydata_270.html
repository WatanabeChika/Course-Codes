<!DOCTYPE html>
<html>
<head>
<title>derangement</title>
</head>
<body>
<div class="mw-parser-output"><style data-mw-deduplicate="TemplateStyles:r1033289096">.mw-parser-output .hatnote{font-style:italic}.mw-parser-output div.hatnote{padding-left:1.6em;margin-bottom:0.5em}.mw-parser-output .hatnote i{font-style:normal}.mw-parser-output .hatnote+link+.hatnote{margin-top:-0.5em}</style>

<p>In combinatorial mathematics, a <b>derangement</b> is a permutation of the elements of a set, such that no element appears in its original position. In other words, a derangement is a permutation that has no fixed points.
</p><p>The number of derangements of a set of size <i>n</i> is known as the <b>subfactorial</b> of <i>n</i> or the <i>n-</i>th <b>derangement number</b> or <i>n-</i>th <b>de Montmort number</b>.  Notations for subfactorials in common use include !<i>n,</i> <i>D<sub>n</sub></i>, <i>d<sub>n</sub></i>, or <i>n</i>¡.<sup class="reference" id="cite_ref-1">[1]</sup><sup class="reference" id="cite_ref-2">[2]</sup>
</p><p>For <i>n</i> &gt; 0, the subfactorial !<i>n</i> equals the nearest integer to <i>n</i>!/<i>e,</i> where <i>n</i>! denotes the factorial of <i>n</i> and <i>e</i> is Euler's number.<sup class="reference" id="cite_ref-:0_3-0">[3]</sup>
</p><p>The problem of counting derangements was first considered by Pierre Raymond de Montmort<sup class="reference" id="cite_ref-4">[4]</sup> in 1708; he solved it in 1713, as did Nicholas Bernoulli at about the same time.
</p>

<h2><span class="mw-headline" id="Example">Example</span><span class="mw-editsection"></span></h2>

<p>Suppose that a professor gave a test to 4 students – A, B, C, and D – and wants to let them grade each other's tests. Of course, no student should grade their own test. How many ways could the professor hand the tests back to the students for grading, such that no student received their own test back? Out of 24 possible permutations (4!) for handing back the tests,
</p>
<dl><dd><table style="font:125% monospace;line-height:1;border-collapse:collapse;">
<tbody><tr>
<td><span style="color:red;font-weight:bold;">ABCD</span>,
</td>
<td><span style="color:red;font-weight:bold;">AB</span>DC,
</td>
<td><span style="color:red;font-weight:bold;">A</span>CB<span style="color:red;font-weight:bold;">D</span>,
</td>
<td><span style="color:red;font-weight:bold;">A</span>CDB,
</td>
<td><span style="color:red;font-weight:bold;">A</span>DBC,
</td>
<td><span style="color:red;font-weight:bold;">A</span>D<span style="color:red;font-weight:bold;">C</span>B,
</td></tr>
<tr>
<td>BA<span style="color:red;font-weight:bold;">CD</span>,
</td>
<td><span style="color:blue;font-style:italic;">BADC</span>,
</td>
<td>BCA<span style="color:red;font-weight:bold;">D</span>,
</td>
<td><span style="color:blue;font-style:italic;">BCDA</span>,
</td>
<td><span style="color:blue;font-style:italic;">BDAC</span>,
</td>
<td>BD<span style="color:red;font-weight:bold;">C</span>A,
</td></tr>
<tr>
<td>CAB<span style="color:red;font-weight:bold;">D</span>,
</td>
<td><span style="color:blue;font-style:italic;">CADB</span>,
</td>
<td>C<span style="color:red;font-weight:bold;">B</span>A<span style="color:red;font-weight:bold;">D</span>,
</td>
<td>C<span style="color:red;font-weight:bold;">B</span>DA,
</td>
<td><span style="color:blue;font-style:italic;">CDAB</span>,
</td>
<td><span style="color:blue;font-style:italic;">CDBA</span>,
</td></tr>
<tr>
<td><span style="color:blue;font-style:italic;">DABC</span>,
</td>
<td>DA<span style="color:red;font-weight:bold;">C</span>B,
</td>
<td>D<span style="color:red;font-weight:bold;">B</span>AC,
</td>
<td>D<span style="color:red;font-weight:bold;">BC</span>A,
</td>
<td><span style="color:blue;font-style:italic;">DCAB</span>,
</td>
<td><span style="color:blue;font-style:italic;">DCBA</span>.
</td></tr></tbody></table></dd></dl>
<p>there are only 9 derangements (shown in blue italics above). In every other permutation of this 4-member set, at least one student gets their own test back (shown in bold red).
</p><p>Another version of the problem arises when we ask for the number of ways <i>n</i> letters, each addressed to a different person, can be placed in <i>n</i> pre-addressed envelopes so that no letter appears in the correctly addressed envelope.
</p>
<h2><span class="mw-headline" id="Counting_derangements">Counting derangements</span><span class="mw-editsection"></span></h2>
<p>Counting derangements of a set amounts to the <i>hat-check problem</i>, in which one considers the number of ways in which <i>n</i> hats (call them <i>h</i><sub>1</sub> through <i>h<sub>n</sub></i>) can be returned to <i>n</i> people (<i>P</i><sub>1</sub> through <i>P<sub>n</sub></i>) such that no hat makes it back to its owner.<sup class="reference" id="cite_ref-5">[5]</sup>
</p><p>Each person may receive any of the <i>n</i> − 1 hats that is not their own. Call the hat which the person <i>P</i><sub>1</sub> receives <i>h<sub>i</sub></i> and consider <i>h<sub>i</sub></i>’s owner: <i>P<sub>i</sub></i> receives either <i>P</i><sub>1</sub>'s hat, <i>h</i><sub>1</sub>, or some other. Accordingly, the problem splits into two possible cases:
</p>
<ol><li><i>P<sub>i</sub></i> receives a hat other than <i>h</i><sub>1</sub>. This case is equivalent to solving the problem with <i>n</i> − 1 people and <i>n</i> − 1 hats because for each of the <i>n</i> − 1 people besides <i>P</i><sub>1</sub> there is exactly one hat from among the remaining <i>n</i> − 1 hats that they may not receive (for any <i>P<sub>j</sub></i> besides <i>P<sub>i</sub></i>, the unreceivable hat is <i>h<sub>j</sub></i>, while for <i>P<sub>i</sub></i> it is <i>h</i><sub>1</sub>). Another way to see this is to rename <i>h</i><sub>1</sub> to <i>h</i><sub>i</sub>, where the derangement is more explicit: for any <i>j</i> from 2 to <i>n</i>, <i>P</i><sub>j</sub> cannot receive <i>h</i><sub>j</sub>.</li>
<li><i>P<sub>i</sub></i> receives <i>h</i><sub>1</sub>. In this case the problem reduces to <i>n</i> − 2 people and <i>n</i> − 2 hats, because <i>P</i><sub>1</sub> received <i>h<sub>i</sub></i><span class="nowrap" style="padding-left:0.1em;">'</span>s hat and <i>P</i><sub>i</sub> received <i>h<sub>1</sub>'</i>s hat, effectively putting both out of further consideration.</li></ol>
<p>For each of the <i>n</i> − 1 hats that <i>P</i><sub>1</sub> may receive, the number of ways that <i>P</i><sub>2</sub>, …, <i>P<sub>n</sub></i> may all receive hats is the sum of the counts for the two cases.
</p><p>This gives us the solution to the hat-check problem: stated algebraically, the number !<i>n</i> of derangements of an <i>n</i>-element set is
</p>
<dl><dd><span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle !n=(n-1)({!(n-1)}+{!(n-2)})}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo>!</mo>
<mi>n</mi>
<mo>=</mo>
<mo stretchy="false">(</mo>
<mi>n</mi>
<mo>−<!-- − --></mo>
<mn>1</mn>
<mo stretchy="false">)</mo>
<mo stretchy="false">(</mo>
<mrow class="MJX-TeXAtom-ORD">
<mo>!</mo>
<mo stretchy="false">(</mo>
<mi>n</mi>
<mo>−<!-- − --></mo>
<mn>1</mn>
<mo stretchy="false">)</mo>
</mrow>
<mo>+</mo>
<mrow class="MJX-TeXAtom-ORD">
<mo>!</mo>
<mo stretchy="false">(</mo>
<mi>n</mi>
<mo>−<!-- − --></mo>
<mn>2</mn>
<mo stretchy="false">)</mo>
</mrow>
<mo stretchy="false">)</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle !n=(n-1)({!(n-1)}+{!(n-2)})}</annotation>
</semantics>
</math></span><img alt="{\displaystyle !n=(n-1)({!(n-1)}+{!(n-2)})}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d7e18e9208997990ebc554fed8e4bd28d41a1feb" style="vertical-align: -0.838ex; width:32.704ex; height:2.843ex;"/></span> for <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle n\geq 2}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>n</mi>
<mo>≥<!-- ≥ --></mo>
<mn>2</mn>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle n\geq 2}</annotation>
</semantics>
</math></span><img alt="n\geq 2" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/e6bf67f9d06ca3af619657f8d20ee1322da77174" style="vertical-align: -0.505ex; width:5.656ex; height:2.343ex;"/></span>,</dd></dl>
<p>where <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle !0=1}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo>!</mo>
<mn>0</mn>
<mo>=</mo>
<mn>1</mn>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle !0=1}</annotation>
</semantics>
</math></span><img alt="{\displaystyle !0=1}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/5b0bd342b5b9d71165ac5fc36f5c39d3ff7ff87f" style="vertical-align: -0.338ex; width:6.07ex; height:2.176ex;"/></span> and <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle !1=0}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo>!</mo>
<mn>1</mn>
<mo>=</mo>
<mn>0</mn>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle !1=0}</annotation>
</semantics>
</math></span><img alt="{\displaystyle !1=0}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/4e011e100aac115e39f06cf3093089248eefb8a7" style="vertical-align: -0.338ex; width:6.07ex; height:2.176ex;"/></span>.<sup class="reference" id="cite_ref-EC1_6-0">[6]</sup>
</p><p>The number of derangements of small lengths is given in the table below.
</p>
<table class="wikitable">
<caption>The number of derangements of an <i>n</i>-element set (sequence <span class="nowrap external">A000166</span> in the OEIS) for small <i>n</i>
</caption>
<tbody><tr style="text-align: center;">
<th><i>n</i>
</th>
<td>0</td>
<td>1</td>
<td>2</td>
<td>3</td>
<td>4</td>
<td>5</td>
<td>6</td>
<td>7</td>
<td>8</td>
<td>9</td>
<td>10</td>
<td>11</td>
<td>12</td>
<td>13
</td></tr>
<tr>
<th>!<i>n</i>
</th>
<td>1</td>
<td>0</td>
<td>1</td>
<td>2</td>
<td>9</td>
<td>44</td>
<td>265</td>
<td>1,854</td>
<td>14,833</td>
<td>133,496</td>
<td>1,334,961</td>
<td>14,684,570</td>
<td>176,214,841</td>
<td>2,290,792,932
</td></tr></tbody></table>
<p>There are various other expressions for !<i>n</i>, equivalent to the formula given above.  These include
</p>
<dl><dd><span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle !n=n!\sum _{i=0}^{n}{\frac {(-1)^{i}}{i!}}}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo>!</mo>
<mi>n</mi>
<mo>=</mo>
<mi>n</mi>
<mo>!</mo>
<munderover>
<mo>∑<!-- ∑ --></mo>
<mrow class="MJX-TeXAtom-ORD">
<mi>i</mi>
<mo>=</mo>
<mn>0</mn>
</mrow>
<mrow class="MJX-TeXAtom-ORD">
<mi>n</mi>
</mrow>
</munderover>
<mrow class="MJX-TeXAtom-ORD">
<mfrac>
<mrow>
<mo stretchy="false">(</mo>
<mo>−<!-- − --></mo>
<mn>1</mn>
<msup>
<mo stretchy="false">)</mo>
<mrow class="MJX-TeXAtom-ORD">
<mi>i</mi>
</mrow>
</msup>
</mrow>
<mrow>
<mi>i</mi>
<mo>!</mo>
</mrow>
</mfrac>
</mrow>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle !n=n!\sum _{i=0}^{n}{\frac {(-1)^{i}}{i!}}}</annotation>
</semantics>
</math></span><img alt="{\displaystyle !n=n!\sum _{i=0}^{n}{\frac {(-1)^{i}}{i!}}}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/da652f39a69ede28bd5fc41a01c233704a2466df" style="vertical-align: -3.005ex; width:17.726ex; height:7.009ex;"/></span> for <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle n\geq 0}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>n</mi>
<mo>≥<!-- ≥ --></mo>
<mn>0</mn>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle n\geq 0}</annotation>
</semantics>
</math></span><img alt="{\displaystyle n\geq 0}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/ce8a1b7b3bc3c790054d93629fc3b08cd1da1fd0" style="vertical-align: -0.505ex; width:5.656ex; height:2.343ex;"/></span></dd></dl>
<p>and
</p>
<dl><dd><span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle !n=\left[{\frac {n!}{e}}\right]=\left\lfloor {\frac {n!}{e}}+{\frac {1}{2}}\right\rfloor }" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo>!</mo>
<mi>n</mi>
<mo>=</mo>
<mrow>
<mo>[</mo>
<mrow class="MJX-TeXAtom-ORD">
<mfrac>
<mrow>
<mi>n</mi>
<mo>!</mo>
</mrow>
<mi>e</mi>
</mfrac>
</mrow>
<mo>]</mo>
</mrow>
<mo>=</mo>
<mrow>
<mo>⌊</mo>
<mrow>
<mrow class="MJX-TeXAtom-ORD">
<mfrac>
<mrow>
<mi>n</mi>
<mo>!</mo>
</mrow>
<mi>e</mi>
</mfrac>
</mrow>
<mo>+</mo>
<mrow class="MJX-TeXAtom-ORD">
<mfrac>
<mn>1</mn>
<mn>2</mn>
</mfrac>
</mrow>
</mrow>
<mo>⌋</mo>
</mrow>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle !n=\left[{\frac {n!}{e}}\right]=\left\lfloor {\frac {n!}{e}}+{\frac {1}{2}}\right\rfloor }</annotation>
</semantics>
</math></span><img alt="{\displaystyle !n=\left[{\frac {n!}{e}}\right]=\left\lfloor {\frac {n!}{e}}+{\frac {1}{2}}\right\rfloor }" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d522701b28d640964b2e50f781b9e10c385898f5" style="vertical-align: -2.505ex; width:23.998ex; height:6.176ex;"/></span> for <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle n\geq 1,}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>n</mi>
<mo>≥<!-- ≥ --></mo>
<mn>1</mn>
<mo>,</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle n\geq 1,}</annotation>
</semantics>
</math></span><img alt="{\displaystyle n\geq 1,}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/cc38ec6af7dd11fdc9baa67365f23906d76da4bb" style="vertical-align: -0.671ex; width:6.302ex; height:2.509ex;"/></span></dd></dl>
<p>where <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle \left[x\right]}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mrow>
<mo>[</mo>
<mi>x</mi>
<mo>]</mo>
</mrow>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle \left[x\right]}</annotation>
</semantics>
</math></span><img alt="{\displaystyle \left[x\right]}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/bee30b48da3d61e9dfa898ca4d209afdcc6503dc" style="vertical-align: -0.838ex; width:2.623ex; height:2.843ex;"/></span> is the nearest integer function and <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle \left\lfloor x\right\rfloor }" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mrow>
<mo>⌊</mo>
<mi>x</mi>
<mo>⌋</mo>
</mrow>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle \left\lfloor x\right\rfloor }</annotation>
</semantics>
</math></span><img alt="\left\lfloor x\right\rfloor " aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/bf38781dcf23416225b794984a686fcfc3a867b4" style="vertical-align: -0.838ex; width:3.394ex; height:2.843ex;"/></span> is the floor function.<sup class="reference" id="cite_ref-:0_3-1">[3]</sup><sup class="reference" id="cite_ref-EC1_6-1">[6]</sup>
</p><p>Other related formulas include<sup class="reference" id="cite_ref-Mathworld-Subfactorial_7-0">[7]</sup>
</p>

and

<p>The following recurrence also holds:<sup class="reference" id="cite_ref-EC1_6-2">[6]</sup>
</p>
<h3><span id="Derivation_by_inclusion.E2.80.93exclusion_principle"></span><span class="mw-headline" id="Derivation_by_inclusion–exclusion_principle">Derivation by inclusion–exclusion principle</span><span class="mw-editsection"></span></h3>
<p>One may derive a non-recursive formula for the number of derangements of an <i>n</i>-set, as well. For <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle 1\leq k\leq n}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mn>1</mn>
<mo>≤<!-- ≤ --></mo>
<mi>k</mi>
<mo>≤<!-- ≤ --></mo>
<mi>n</mi>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle 1\leq k\leq n}</annotation>
</semantics>
</math></span><img alt="1\leq k\leq n" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/78ec00bc2eb99b403bee93def3c12ae87f1e3c3d" style="vertical-align: -0.505ex; width:9.965ex; height:2.343ex;"/></span> we define <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle S_{k}}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<msub>
<mi>S</mi>
<mrow class="MJX-TeXAtom-ORD">
<mi>k</mi>
</mrow>
</msub>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle S_{k}}</annotation>
</semantics>
</math></span><img alt="S_k" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/fd1325d812cf88e5341ac097d8bda175723da887" style="vertical-align: -0.671ex; width:2.514ex; height:2.509ex;"/></span> to be the set of permutations of <i>n</i> objects that fix the <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle k}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>k</mi>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle k}</annotation>
</semantics>
</math></span><img alt="k" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/c3c9a2c7b599b37105512c5d570edc034056dd40" style="vertical-align: -0.338ex; width:1.211ex; height:2.176ex;"/></span>-th object. Any intersection of a collection of <i>i</i> of these sets fixes a particular set of <i>i</i> objects and therefore contains <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle (n-i)!}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mo stretchy="false">(</mo>
<mi>n</mi>
<mo>−<!-- − --></mo>
<mi>i</mi>
<mo stretchy="false">)</mo>
<mo>!</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle (n-i)!}</annotation>
</semantics>
</math></span><img alt="{\displaystyle (n-i)!}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/8666ec8063996580af0cac9da3a1a9543dc4e80d" style="vertical-align: -0.838ex; width:7.494ex; height:2.843ex;"/></span> permutations. There are <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\textstyle {n \choose i}}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="false" scriptlevel="0">
<mrow class="MJX-TeXAtom-ORD">
<mrow>
<mrow class="MJX-TeXAtom-OPEN">
<mo maxsize="1.2em" minsize="1.2em">(</mo>
</mrow>
<mfrac linethickness="0">
<mi>n</mi>
<mi>i</mi>
</mfrac>
<mrow class="MJX-TeXAtom-CLOSE">
<mo maxsize="1.2em" minsize="1.2em">)</mo>
</mrow>
</mrow>
</mrow>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\textstyle {n \choose i}}</annotation>
</semantics>
</math></span><img alt="{\textstyle {n \choose i}}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/72c0c324ecd17aac2e8149f5c763ffcb3f212afb" style="vertical-align: -1.005ex; width:3.116ex; height:3.176ex;"/></span> such collections, so the inclusion–exclusion principle yields
</p>
and since a derangement is a permutation that leaves none of the <i>n</i> objects fixed, this implies

<h2><span id="Growth_of_number_of_derangements_as_n_approaches_.E2.88.9E"></span><span class="mw-headline" id="Growth_of_number_of_derangements_as_n_approaches_∞">Growth of number of derangements as <i>n</i> approaches ∞</span><span class="mw-editsection"></span></h2>
<p>From
</p>
and

by substituting <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle \textstyle x=-1}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mstyle displaystyle="false" scriptlevel="0">
<mi>x</mi>
<mo>=</mo>
<mo>−<!-- − --></mo>
<mn>1</mn>
</mstyle>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle \textstyle x=-1}</annotation>
</semantics>
</math></span><img alt="\textstyle x = -1" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/2879ddf63abacc72ad3ac231cddf543bbd76c0b1" style="vertical-align: -0.505ex; width:7.399ex; height:2.343ex;"/></span> one immediately obtains that

This is the limit of the probability that a randomly selected permutation of a large number of objects is a derangement. The probability converges to this limit extremely quickly as <i>n</i> increases, which is why !<i>n</i> is the nearest integer to <i>n</i>!/<i>e</i>. The above semi-log graph shows that the derangement graph lags the permutation graph by an almost constant value.
<p>More information about this calculation and the above limit may be found in the article on the
statistics of random permutations.
</p>
<h3><span class="mw-headline" id="Asymptotic_expansion_in_terms_of_Bell_numbers">Asymptotic expansion in terms of Bell numbers</span><span class="mw-editsection"></span></h3>
<p>An asymptotic expansion for the number of derangements in terms of Bell numbers is as follows:
</p>
where <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle m}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>m</mi>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle m}</annotation>
</semantics>
</math></span><img alt="m" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/0a07d98bb302f3856cbabc47b2b9016692e3f7bc" style="vertical-align: -0.338ex; width:2.04ex; height:1.676ex;"/></span> is any fixed positive integer, and <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle B_{k}}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<msub>
<mi>B</mi>
<mrow class="MJX-TeXAtom-ORD">
<mi>k</mi>
</mrow>
</msub>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle B_{k}}</annotation>
</semantics>
</math></span><img alt="B_{k}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/6a6457760e36cf45e1471e33bcc1536cb4802fb9" style="vertical-align: -0.671ex; width:2.853ex; height:2.509ex;"/></span> denotes the <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle k}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi>k</mi>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle k}</annotation>
</semantics>
</math></span><img alt="k" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/c3c9a2c7b599b37105512c5d570edc034056dd40" style="vertical-align: -0.338ex; width:1.211ex; height:2.176ex;"/></span>-th Bell number. Moreover, the constant implied by the big O-term does not exceed <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle B_{m+1}}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<msub>
<mi>B</mi>
<mrow class="MJX-TeXAtom-ORD">
<mi>m</mi>
<mo>+</mo>
<mn>1</mn>
</mrow>
</msub>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle B_{m+1}}</annotation>
</semantics>
</math></span><img alt="{\displaystyle B_{m+1}}" aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/d4b6ab4b5c83418bb568b34195192cfaf7619533" style="vertical-align: -0.671ex; width:5.54ex; height:2.509ex;"/></span>.<sup class="reference" id="cite_ref-8">[8]</sup>
<h2><span class="mw-headline" id="Generalizations">Generalizations</span><span class="mw-editsection"></span></h2>
<p>The problème des rencontres asks how many permutations of a size-<i>n</i> set have exactly <i>k</i> fixed points.
</p><p>Derangements are an example of the wider field of constrained permutations. For example, the <i>ménage problem</i> asks if <i>n</i> opposite-sex couples are seated man-woman-man-woman-... around a table, how many ways can they be seated so that nobody is seated next to his or her partner?
</p><p>More formally, given sets <i>A</i> and <i>S</i>, and some sets <i>U</i> and <i>V</i> of surjections <i>A</i> → <i>S</i>, we often wish to know the number of pairs of functions (<i>f</i>, <i>g</i>) such that <i>f</i> is in <i>U</i> and <i>g</i> is in <i>V</i>, and for all <i>a</i> in <i>A</i>, <i>f</i>(<i>a</i>) ≠ <i>g</i>(<i>a</i>); in other words, where for each <i>f</i> and <i>g</i>, there exists a derangement φ of <i>S</i> such that <i>f</i>(<i>a</i>) = φ(<i>g</i>(<i>a</i>)).
</p><p>Another generalization is the following problem:
</p>
<dl><dd><i>How many anagrams with no fixed letters of a given word are there?</i></dd></dl>
<p>For instance, for a word made of only two different letters, say <i>n</i> letters A and <i>m</i> letters B, the answer is, of course, 1 or 0 according to whether <i>n</i> = <i>m</i> or not, for the only way to form an anagram without fixed letters is to exchange all the <i>A</i> with <i>B</i>, which is possible if and only if <i>n</i> = <i>m</i>.  In the general case, for a word with <i>n</i><sub>1</sub> letters <i>X</i><sub>1</sub>, <i>n</i><sub>2</sub> letters <i>X</i><sub>2</sub>, ..., <i>n</i><sub><i>r</i></sub> letters <i>X</i><sub><i>r</i></sub>, it turns out (after a proper use of the inclusion-exclusion formula) that the answer has the form
</p>
for a certain sequence of polynomials <i>P</i><sub><i>n</i></sub>, where <i>P</i><sub><i>n</i></sub> has degree <i>n</i>.  But the above answer for the case <i>r</i> = 2 gives an orthogonality relation, whence the <i>P</i><sub><i>n</i></sub>'s are the Laguerre polynomials (up to a sign that is easily decided).<sup class="reference" id="cite_ref-9">[9]</sup>

<p>In particular, for the classical derangements, one has that
</p>
where <span class="mwe-math-element"><span class="mwe-math-mathml-inline mwe-math-mathml-a11y" style="display: none;"><math alttext="{\displaystyle \Gamma (s,x)}" xmlns="http://www.w3.org/1998/Math/MathML">
<semantics>
<mrow class="MJX-TeXAtom-ORD">
<mstyle displaystyle="true" scriptlevel="0">
<mi mathvariant="normal">Γ<!-- Γ --></mi>
<mo stretchy="false">(</mo>
<mi>s</mi>
<mo>,</mo>
<mi>x</mi>
<mo stretchy="false">)</mo>
</mstyle>
</mrow>
<annotation encoding="application/x-tex">{\displaystyle \Gamma (s,x)}</annotation>
</semantics>
</math></span><img alt=" \Gamma(s,x) " aria-hidden="true" class="mwe-math-fallback-image-inline" src="https://wikimedia.org/api/rest_v1/media/math/render/svg/de56b620724ff26935177bd16ff2d296baea4f28" style="vertical-align: -0.838ex; width:6.716ex; height:2.843ex;"/></span> is the upper incomplete gamma function.

<h2><span class="mw-headline" id="Computational_complexity">Computational complexity</span><span class="mw-editsection"></span></h2>
<p>It is NP-complete to determine whether a given permutation group (described by a given set of permutations that generate it) contains any derangements.<sup class="reference" id="cite_ref-10">[10]</sup>
</p>
<h2><span class="mw-headline" id="References">References</span><span class="mw-editsection"></span></h2>
<style data-mw-deduplicate="TemplateStyles:r1011085734">.mw-parser-output .reflist{font-size:90%;margin-bottom:0.5em;list-style-type:decimal}.mw-parser-output .reflist .references{font-size:100%;margin-bottom:0;list-style-type:inherit}.mw-parser-output .reflist-columns-2{column-width:30em}.mw-parser-output .reflist-columns-3{column-width:25em}.mw-parser-output .reflist-columns{margin-top:0.3em}.mw-parser-output .reflist-columns ol{margin-top:0}.mw-parser-output .reflist-columns li{page-break-inside:avoid;break-inside:avoid-column}.mw-parser-output .reflist-upper-alpha{list-style-type:upper-alpha}.mw-parser-output .reflist-upper-roman{list-style-type:upper-roman}.mw-parser-output .reflist-lower-alpha{list-style-type:lower-alpha}.mw-parser-output .reflist-lower-greek{list-style-type:lower-greek}.mw-parser-output .reflist-lower-roman{list-style-type:lower-roman}</style>
<h2><span class="mw-headline" id="External_links">External links</span><span class="mw-editsection"></span></h2>
<style data-mw-deduplicate="TemplateStyles:r1097025294">.mw-parser-output .side-box{margin:4px 0;box-sizing:border-box;border:1px solid #aaa;font-size:88%;line-height:1.25em;background-color:#f9f9f9}.mw-parser-output .side-box-abovebelow,.mw-parser-output .side-box-text{padding:0.25em 0.9em}.mw-parser-output .side-box-image{padding:2px 0 2px 0.9em;text-align:center}.mw-parser-output .side-box-imageright{padding:2px 0.9em 2px 0;text-align:center}@media(min-width:500px){.mw-parser-output .side-box-flex{display:flex;align-items:center}.mw-parser-output .side-box-text{flex:1}}@media(min-width:720px){.mw-parser-output .side-box{width:238px}.mw-parser-output .side-box-right{clear:right;float:right;margin-left:1em}.mw-parser-output .side-box-left{margin-right:1em}}</style>
<ul><li><link href="mw-data:TemplateStyles:r1067248974" rel="mw-deduplicated-inline-style"/><cite class="citation web cs1" id="CITEREFBaez,_John2003">Baez, John (2003). "Let's get deranged!" <span class="cs1-format">(PDF)</span>.</cite><span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=unknown&amp;rft.btitle=Let%27s+get+deranged%21&amp;rft.date=2003&amp;rft.au=Baez%2C+John&amp;rft_id=http%3A%2F%2Fmath.ucr.edu%2Fhome%2Fbaez%2Fqg-winter2004%2Fderangement.pdf&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3ADerangement"></span></li>
<li><link href="mw-data:TemplateStyles:r1067248974" rel="mw-deduplicated-inline-style"/><cite class="citation web cs1" id="CITEREFBogart,_Kenneth_P.Doyle,_Peter_G.1985">Bogart, Kenneth P.; Doyle, Peter G. (1985). "Non-sexist solution of the ménage problem".</cite><span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=unknown&amp;rft.btitle=Non-sexist+solution+of+the+m%C3%A9nage+problem&amp;rft.date=1985&amp;rft.au=Bogart%2C+Kenneth+P.&amp;rft.au=Doyle%2C+Peter+G.&amp;rft_id=http%3A%2F%2Fwww.math.dartmouth.edu%2F~doyle%2Fdocs%2Fmenage%2Fmenage%2Fmenage.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3ADerangement"></span></li>
<li><link href="mw-data:TemplateStyles:r1067248974" rel="mw-deduplicated-inline-style"/><cite class="citation web cs1" id="CITEREFHassani,_Mehdi">Hassani, Mehdi. "Derangements and Applications". Journal of Integer Sequences (JIS), Volume 6, Issue 1, Article 03.1.2, 2003.</cite><span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=unknown&amp;rft.btitle=Derangements+and+Applications&amp;rft.pub=Journal+of+Integer+Sequences+%28JIS%29%2C+Volume+6%2C+Issue+1%2C+Article+03.1.2%2C+2003&amp;rft.au=Hassani%2C+Mehdi&amp;rft_id=http%3A%2F%2Fwww.cs.uwaterloo.ca%2Fjournals%2FJIS%2FVOL6%2FHassani%2Fhassani5.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3ADerangement"></span></li>
<li><link href="mw-data:TemplateStyles:r1067248974" rel="mw-deduplicated-inline-style"/><cite class="citation web cs1" id="CITEREFWeisstein,_Eric_W">Weisstein, Eric W. "Derangement". MathWorld–A Wolfram Web Resource.</cite><span class="Z3988" title="ctx_ver=Z39.88-2004&amp;rft_val_fmt=info%3Aofi%2Ffmt%3Akev%3Amtx%3Abook&amp;rft.genre=unknown&amp;rft.btitle=Derangement&amp;rft.pub=MathWorld%E2%80%93A+Wolfram+Web+Resource&amp;rft.au=Weisstein%2C+Eric+W&amp;rft_id=http%3A%2F%2Fmathworld.wolfram.com%2FDerangement.html&amp;rfr_id=info%3Asid%2Fen.wikipedia.org%3ADerangement"></span></li></ul>
<!-- 
NewPP limit report
Parsed by mw2414
Cached time: 20221224013044
Cache expiry: 1814400
Reduced expiry: false
Complications: [vary‐revision‐sha1, show‐toc]
CPU time usage: 0.246 seconds
Real time usage: 0.373 seconds
Preprocessor visited node count: 1377/1000000
Post‐expand include size: 23327/2097152 bytes
Template argument size: 1254/2097152 bytes
Highest expansion depth: 16/100
Expensive parser function count: 1/500
Unstrip recursion depth: 1/20
Unstrip post‐expand size: 36368/5000000 bytes
Lua time usage: 0.109/10.000 seconds
Lua memory usage: 5417908/52428800 bytes
Number of Wikibase entities loaded: 0/400
-->
<!--
Transclusion expansion time report (%,ms,calls,template)
100.00%  234.622      1 -total
 55.23%  129.593      1 Template:Reflist
 29.78%   69.882      3 Template:Citation
 20.12%   47.199      1 Template:Short_description
 10.91%   25.589      2 Template:Pagetype
  7.64%   17.935      1 Template:For
  7.57%   17.765      1 Template:Wiktionary
  6.77%   15.874      1 Template:Sister_project
  6.65%   15.604      1 Template:ISBN
  6.08%   14.266      1 Template:Side_box
-->
<!-- Saved in parser cache with key enwiki:pcache:idhash:162132-0!canonical and timestamp 20221224013044 and revision id 1122558919.
 -->
</div></body>
</html>